<div class="col-lg-8 col-sm-12 form-container">
  <nz-tabset [nzSelectedIndex]="selectedIndex" nzCentered [nzSize]="'large'" [nzTabBarGutter]="20" [nzTabBarStyle]="{
  'font-family': 'Hahmlet, Roboto, sans-serif;' 
  }"  (nzSelectChange)="onTabChange($event)">
    <nz-tab [nzTitle]="'Profile'">
      <ng-container *ngTemplateOutlet="ProfileTemplate"></ng-container>
    </nz-tab>
    <nz-tab [nzTitle]="'Contact'">
      <ng-container *ngTemplateOutlet="ContactTemplate"></ng-container>
    </nz-tab>
    <nz-tab [nzTitle]="'Institution'">
      <ng-container *ngTemplateOutlet="InstitutionTemplate"></ng-container>
    </nz-tab>
    <nz-tab [nzTitle]="'Account Settings'">
      <ng-container *ngTemplateOutlet="AccountSettingsTemplate"></ng-container>
    </nz-tab>
  </nz-tabset>
</div>
<form [formGroup]="memberForm" novalidate (submit)="submitForm(memberForm, formDirective)" #formDirective="ngForm">
  <!-- PROFILE TAB UI -->
  <ng-template #ProfileTemplate nz-tab>
    <div class="scroll-feed" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50" [fromRoot]="true"
      (scrolled)="onScroll()">
      <form formGroupName="profile">
        <p></p>
        <div class="col-lg-3 col-md-4 col-sm-12 floating-avatar">
          <div *ngIf="memberForm.get('profile').get('avatar').value" class="col-lg-12 col-md-12 col-sm-12">
            <div class="image-container" (click)="avatarUpdate.click()">
              <img [src]="previewPath" class="thumbnail" alt="Your avatar" />
              <div class="centered">Click here to update image</div>
            </div>
          </div>
          <mat-hint>Your photo will only be visible to other members of {{ currentMember.institution.name }} and the
            administrators of Shuddhi Vidhya.
          </mat-hint>
          <input matInput hidden />
          <mat-label [hidden]="previewPath">Avatar</mat-label>
          <br />
          <br />
          <input [hidden]="previewPath" #avatarUpdate id="avatar-choose-button" type="file" accept="image/*"
            placeholder="Your avatar" (change)="onAvatarChange($event)" />
        </div>
        <mat-form-field class="col-lg-9 col-md-12 col-sm-12" appearance="outline">
          <mat-label>First Name</mat-label>
          <input matInput formControlName="firstName" placeholder="Your first name" />
          <small class="validation-error" *ngIf="
           memberForm.get('profile').get('firstName').hasError('required') &&
           formDirective.submitted
           "> First Name is required </small>
        </mat-form-field>
        <mat-form-field class="col-lg-9 col-md-12 col-sm-12" appearance="outline">
          <mat-label>Last Name</mat-label>
          <input matInput formControlName="lastName" placeholder="Your last name" />
          <small class="validation-error" *ngIf="
           memberForm.get('profile').get('lastName').hasError('required') &&
           formDirective.submitted
           "> Last Name is required </small>
        </mat-form-field>
        <mat-form-field class="col-lg-9 col-md-12 col-sm-12" appearance="outline">
          <mat-label>Date of birth</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="dob" placeholder="Date of birth">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </form>
    </div>
  </ng-template>
  <!-- CONTACT TAB UI -->
  <ng-template #ContactTemplate nz-tab>
    <div class="scroll-feed" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50" [fromRoot]="true"
      (scrolled)="onScroll()">
      <form formGroupName="contact">
        <div>
          <mat-form-field class="col-lg-6 col-md-6 col-sm-6" disabled appearance="outline">
            <mat-label>Mobile</mat-label>
            <input matInput formControlName="mobile" placeholder="Mobile" onlyNumber/>
            <small class="validation-error" *ngIf="
              memberForm.get('contact').get('mobile').hasError('') &&
              formDirective.submitted
              "> Mobile No is required</small>
            <small class="validation-error" *ngIf="
              memberForm.get('contact').get('mobile').hasError('mobile') && formDirective.submitted
              "> Please enter a valid Mobile No </small>
          </mat-form-field>
          <mat-form-field class="col-lg-6 col-md-6 col-sm-6" disabled appearance="outline">
            <mat-label>Phone</mat-label>
            <input matInput formControlName="phone" placeholder="Phone" onlyNumber/>
          </mat-form-field>
          <mat-form-field class="col-lg-12 col-md-12 col-sm-12" disabled appearance="outline">
            <mat-label>Address</mat-label>
            <textarea matInput formControlName="address" placeholder="Your communication address"></textarea>
          </mat-form-field>
          <mat-form-field class="col-lg-4 col-md-4 col-sm-4" disabled appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" placeholder="City" />
          </mat-form-field>
          <mat-form-field class="col-lg-4 col-md-4 col-sm-4" disabled appearance="outline">
            <mat-label>Pincode</mat-label>
            <input matInput formControlName="pincode" placeholder="Pincode" />
          </mat-form-field>
          <mat-form-field class="col-lg-4 col-md-4 col-sm-4" disabled appearance="outline">
            <mat-label>State</mat-label>
            <input matInput formControlName="state" placeholder="State" />
          </mat-form-field>
          <mat-form-field class="col-lg-4 col-md-4 col-sm-4" disabled appearance="outline">
            <mat-label>Country</mat-label>
            <input matInput formControlName="country" placeholder="Country" />
            <small class="validation-error" *ngIf="
              memberForm.get('contact').get('country').hasError('') &&
              formDirective.submitted
              "> Country is required</small>
          </mat-form-field>
          <mat-form-field class="col-lg-6 col-md-6 col-sm-6" disabled appearance="outline">
            <mat-label>Email ID</mat-label>
            <input matInput formControlName="email" required readonly placeholder="Email ID" />
            <small class="validation-error" *ngIf="
              memberForm.get('contact').get('email').hasError('required') &&
              formDirective.submitted
              "> Email is required </small>
            <small class="validation-error" *ngIf="
              memberForm.get('contact').get('email').hasError('email') && formDirective.submitted
              "> Please enter a valid email </small>
          </mat-form-field>
        </div>
      </form>
    </div>
  </ng-template>
  <!-- INSTITUTION TAB UI -->
  <ng-template #InstitutionTemplate nz-tab>
    <div class="scroll-feed" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50" [fromRoot]="true"
      (scrolled)="onScroll()">
      <form formGroupName="institution">
        <div>
          <mat-form-field class="col-lg-12 col-md-12 col-sm-12" [class.dropdoawn-loading]="isFetchingInstitutions"
            appearance="outline">
            <mat-label>Institution Type</mat-label>
            <mat-select formControlName="institutionType" placeholder="Institution Type"
              (valueChange)="institutionTypeChange($event)">
              <mat-option *ngFor="let type of institutionTypeOptions" [value]="type.value">
                {{ type.label }}
              </mat-option>
            </mat-select>
            <small class="validation-error" *ngIf="
              memberForm.get('institution').get('institutionType').hasError('required') &&
              formDirective.submitted
              ">
              Institution Type is required
            </small>
          </mat-form-field>
          <mat-form-field class="col-lg-12 col-md-12 col-sm-12"
            *ngIf="memberForm.get('institution').get('institutionType').value?true:false"
            [class.dropdoawn-loading]="isFetchingInstitutions" appearance="outline">
            <mat-label>Institution</mat-label>
            <input type="text" matInput [matAutocomplete]="auto" ([ngModel])="institutionName" (input)="filter($event)"  #autoInput>
            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn.bind(this)">
              <div *ngIf="filteredOptions$ | async as filteredOptions">
                <ng-container *ngIf="filteredOptions.length; else noItems">
                  <mat-option *ngFor="let institution of filteredOptions;let i=index; let l = count"
                    [value]="institution"   (onSelectionChange)="selectInstitution($event,institution)">
                    {{ institution.name }}
                  </mat-option>
                </ng-container>
                <ng-template #noItems>No Items!</ng-template>
              </div>
              <mat-option>
                <button mat-raised-button color="primary" (click)="addNewInstitution($event)">Can't find your
                  institution? Add it!</button>
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
          <mat-form-field class="col-lg-12 col-md-12 col-sm-12"
            *ngIf="memberForm.get('institution').get('institution').value?true:false" appearance="outline">
            <mat-label>Designation</mat-label>
            <mat-select formControlName="designation" placeholder="Designation">
              <mat-option *ngFor="let designation of designationOptions" [value]="designation">
                {{designation }}
              </mat-option>
            </mat-select>
            <small class="validation-error" *ngIf="
              memberForm.get('institution').get('designation').hasError('required') &&
              formDirective.submitted
              ">
              Designation is required
            </small>
          </mat-form-field>
        </div>
      </form>
    </div>
  </ng-template>
  <!-- ACCOUNT SETTINGS TAB UI -->
  <ng-template #AccountSettingsTemplate nz-tab>
    <div class="scroll-feed" infiniteScroll [infiniteScrollDistance]="2" [infiniteScrollThrottle]="50" [fromRoot]="true"
      (scrolled)="onScroll()">
      <form formGroupName="accountSetting" #formDirective="ngForm">
        <div>
          <mat-form-field class="col-lg-12 col-md-12 col-sm-12" appearance="outline">
            <mat-label>User Name</mat-label>
            <input matInput specialIsAlphaNumeric placeholder="Your UserName"
              
              formControlName="username" maxlength="16" />
            <small class="validation-error" *ngIf="
              memberForm.get('accountSetting').get('username').hasError('required') &&
              formDirective.submitted
              "> UserName is required </small>
            <small class="validation-error" *ngIf="!memberForm.get('accountSetting').get('username')?.valid && (memberForm.get('accountSetting').get('username')?.dirty
              ||memberForm.get('accountSetting').get('username')?.touched)"> Please Enter Valid UserName </small>
          </mat-form-field>
          <small class="col-lg-12 col-md-12 col-sm-12"> You will not able to change the username later. </small>
          <div class="col-lg-9 col-md-12 col-sm-12">
            <button mat-stroked-button color="primary"
              (click)="passwordUpdate(memberForm.get('contact').get('email'),formDirective)">{{newPasswordBtnName}}</button>
          </div>
        </div>
      </form>
    </div>
  </ng-template>
  <button type="submit" class="floating-button-bottom" mat-raised-button color="primary"
    [disabled]="(formSubmitting$ | async) === true">
    {{ (formSubmitting$ | async) === true ? "Submitting..." : "Submit" }}
  </button>
</form>